function Bullet(){this.ele=document.createElement("div");this.id=parseInt(Math.random()*1e5)+"";this.init=function(){this.ele.className="bullet";gameEngine.ele.appendChild(this.ele);gameEngine.bullets[this.id]=this;var e=myPlane.ele.offsetLeft+myPlane.ele.offsetWidth/2-this.ele.offsetWidth/2;this.ele.style.left=e+"px";this.ele.style.top=myPlane.ele.offsetTop-this.ele.offsetHeight+"px";return this},this.move=function(){var e=this;this.timer=setInterval(function(){if(e.ele.offsetTop<-18){clearInterval(e.timer);gameEngine.ele.removeChild(e.ele);delete gameEngine.bullets[e.id]}else{e.ele.style.top=e.ele.offsetTop-10+"px"}},30)};this.boom=function(){clearInterval(this.timer);this.ele.className="bullet-die";var e=this;var n=0;var t=["images/die1.png","images/die2.png"];var i=setInterval(function(){if(n>=2){clearInterval(i);gameEngine.ele.removeChild(e.ele)}else{e.ele.style.background="url("+t[n]+") no-repeat";n++}},50)}}function isCrash(e,n){if(e&&n){var t=n.offsetLeft-e.offsetWidth/2;var i=n.offsetLeft+n.offsetWidth+e.offsetWidth/2;var l=n.offsetTop-e.offsetHeight/2;var s=n.offsetTop+n.offsetHeight+e.offsetHeight/2;var a=e.offsetLeft+e.offsetWidth/2;var o=e.offsetTop+e.offsetHeight/2;if(a>t&&a<i&&o>l&&o<s){return true}}return false}function Enemy(e){this.ele=document.createElement("div");this.hp=0;this.speed=0;this.dieImgs=[];this.id=parseInt(Math.random()*1e5)+"";this.score=0;this.init=function(){switch(e){case this.Enemy_Type_Large:this.ele.className="enemy-large";this.hp=this.Enemy_HP_Large;this.speed=this.Enemy_Speed_Large;this.dieImgs=["images/plane3_die1.png","images/plane3_die2.png","images/plane3_die3.png","images/plane3_die4.png","images/plane3_die5.png","images/plane3_die6.png"];this.score=30;break;case this.Enemy_Type_Middle:this.ele.className="enemy-middle";this.hp=this.Enemy_HP_Middle;this.speed=this.Enemy_Speed_Middle;this.dieImgs=["images/plane2_die1.png","images/plane2_die2.png","images/plane2_die3.png","images/plane2_die4.png"];this.score=20;break;case this.Enemy_Type_Small:this.ele.className="enemy-small";this.hp=this.Enemy_HP_Small;this.speed=this.Enemy_Speed_Small;this.dieImgs=["images/plane1_die1.png","images/plane1_die2.png","images/plane1_die3.png"];this.score=10;break}gameEngine.ele.appendChild(this.ele);gameEngine.enemys[this.id]=this;var n=Math.random()*(gameEngine.ele.offsetWidth-this.ele.offsetWidth);this.ele.style.left=n+"px";this.ele.style.top=-this.ele.offsetHeight+"px";return this};this.move=function(){var e=this;this.timer=setInterval(function(){if(e.ele.offsetTop>gameEngine.ele.offsetHeight){clearInterval(e.timer);gameEngine.ele.removeChild(e.ele);delete gameEngine.enemys[e.id]}else{e.ele.style.top=e.ele.offsetTop+e.speed+"px"}},30)};this.hurt=function(){this.hp--;if(this.hp==0){this.boom();gameEngine.scoreNode.innerHTML=gameEngine.scoreNode.innerHTML-0+this.score}};this.boom=function(){clearInterval(this.timer);var e=this;var n=0;var t=setInterval(function(){if(n>=e.dieImgs.length){clearInterval(t);gameEngine.ele.removeChild(e.ele);delete gameEngine.enemys[e.id]}else{e.ele.style.background="url("+e.dieImgs[n++]+") no-repeat"}},50)}}Enemy.prototype={Enemy_Type_Large:1,Enemy_Type_Middle:2,Enemy_Type_Small:3,Enemy_HP_Large:8,Enemy_HP_Middle:4,Enemy_HP_Small:1,Enemy_Speed_Large:2,Enemy_Speed_Middle:4,Enemy_Speed_Small:8};var gameEngine={ele:null,bullets:{},enemys:{},isCrashMyPlane:false,scoreNode:null,init:function(){this.ele=document.getElementById("main_body");return this},start:function(){gameEngine.loading(function(){console.log("开始正式游戏");myPlane.init().fire();gameEngine.keyListening();gameEngine.createEnemy();gameEngine.crashListening();gameEngine.showScore();gameEngine.move()})},loading:function(e){var n=document.createElement("div");n.className="logo";gameEngine.ele.appendChild(n);var t=document.createElement("div");t.className="loading";gameEngine.ele.appendChild(t);var i=0;var l=["images/loading1.png","images/loading2.png","images/loading3.png"];var s=setInterval(function(){if(i>=2){clearInterval(s);gameEngine.ele.removeChild(n);gameEngine.ele.removeChild(t);e()}else{i++;t.style.background="url("+l[i%3]+") no-repeat"}},500)},keyListening:function(){var e=0;window.onkeydown=function(n){var t=n||event;var i=t.keyCode;console.log(i);if(i==37){e=-10}else if(i==39){e=10}};window.onkeyup=function(){e=0};setInterval(function(){var n=myPlane.ele.offsetLeft+e;if(n<0){n=0}else if(n>gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth){n=gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth}myPlane.ele.style.left=n+"px"},30)},createEnemy:function(){setInterval(e,6e3);function e(){var e=Math.random()>.5?true:false;if(e){var n=new Enemy(Enemy.prototype.Enemy_Type_Large);n.init().move()}}setInterval(n,1e3);function n(){var e=Math.random()>.7?true:false;if(e){var n=new Enemy(Enemy.prototype.Enemy_Type_Middle);n.init().move()}}setInterval(t,500);function t(){var e=Math.random()>.5?true:false;if(e){var n=new Enemy(Enemy.prototype.Enemy_Type_Small);n.init().move()}}},crashListening:function(){setInterval(function(){for(var e in gameEngine.enemys){for(var n in gameEngine.bullets){if(isCrash(gameEngine.enemys[e].ele,gameEngine.bullets[n].ele)){console.log("检测到碰撞");gameEngine.bullets[n].boom();delete gameEngine.bullets[n];gameEngine.enemys[e].hurt()}}if(!self.isCrashMyPlane&&isCrash(gameEngine.enemys[e].ele,myPlane.ele)){self.isCrashMyPlane=true;myPlane.boom(function(){console.log("Game Over!");alert("Game Over!");location.reload()})}}},30)},showScore:function(){this.scoreNode=document.createElement("div");this.scoreNode.className="score";this.scoreNode.innerHTML="0";gameEngine.ele.appendChild(this.scoreNode)},move:function(){var e=0;setInterval(function(){gameEngine.ele.style.backgroundPositionY=e+++"px"},30)}};var myPlane={ele:null,fireInterval:80,init:function(){this.ele=document.createElement("div");this.ele.className="myplane";gameEngine.ele.appendChild(this.ele);var e=(gameEngine.ele.offsetWidth-this.ele.offsetWidth)/2;this.ele.style.left=e+"px";this.ele.style.bottom=0;this.startDrag();return this},fire:function(){this.timer=setInterval(function(){var e=new Bullet;e.init().move()},this.fireInterval)},startDrag:function(){this.ele.onmousedown=function(e){var n=e||event;var t=n.offsetX;var i=n.offsetY;document.onmousemove=function(e){var n=e||event;var l=n.clientX-gameEngine.ele.offsetLeft-t;var s=n.clientY-i;if(l<0){l=0}else if(l>gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth){l=gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth}myPlane.ele.style.left=l+"px";myPlane.ele.style.top=s+"px"};document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null}}},boom:function(e){clearInterval(this.timer);var n=["images/me_die1.png","images/me_die2.png","images/me_die3.png","images/me_die4.png"];var t=0;var i=setInterval(function(){if(t>=n.length){clearInterval(i);gameEngine.ele.removeChild(myPlane.ele);e()}else{myPlane.ele.style.background="url("+n[t++]+") no-repeat"}},50)}};